<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qifenqian.bms.merchant.reported.mapper.AllinPayMapper">

	<select id="getAllinPayIndustryList" resultType="com.qifenqian.bms.merchant.reported.bean.Industry">
	SELECT 
		a.mcc_id industryCode,
		a.mcc_name industryName
	FROM 
		td_allinpay_mcc_info a
	</select>
	
	<select id="getProvinceName" resultType="com.qifenqian.bms.merchant.reported.bean.Province">
	SELECT
		a.area_code provinceId,
		a.area_name provinceName 
	FROM
		td_allinpay_area_info a 
	WHERE
		a.area_code IN ( SELECT DISTINCT province_code provinceId FROM td_allinpay_area_info );
	</select>
	
	<select id="getBankInfo" resultType="com.qifenqian.bms.merchant.reported.bean.Bank">
	SELECT 
		b.bank_code bankId,
		b.bank_name bankName
	FROM 
		td_allinpay_bank_info b
	</select>

	
	<select id="selTdMerchantDetailInfo" parameterType="com.qifenqian.bms.merchant.reported.bean.TdMerchantDetailInfo"  resultType="com.qifenqian.bms.merchant.reported.bean.TdMerchantDetailInfo">
		SELECT
			t1.*
		FROM
			td_merchant_report t1
		WHERE
			t1.`merchant_code` = #{merchantCode,jdbcType = VARCHAR} and t1.channel_no = #{channelNo,jdbcType = VARCHAR}
	</select>
	
    <update id="updateTdMerchantDetailInfo"  parameterType="com.qifenqian.bms.merchant.reported.bean.TdMerchantDetailInfo" >
    	 UPDATE `stcdb`.`td_merchant_detail_info`
		 SET 
		 	<if test="reportStatus != null and reportStatus !='' ">
		 	`report_status` = #{reportStatus,jdbcType = VARCHAR},
		 	</if>
		 	<if test="fileStatus != null and fileStatus !='' ">
		 	`file_status` = #{fileStatus,jdbcType = VARCHAR},
		 	</if>
		 	<if test="outMerchantCode != null and outMerchantCode !='' ">
		 	`out_merchant_code` = #{outMerchantCode,jdbcType = VARCHAR},
		 	</if>
		 	<if test="remark != null and remark !='' ">
		 	`remark` = #{remark,jdbcType = VARCHAR},
		 	</if>
		 	<if test="bestMerchantType != null and bestMerchantType !='' ">
		 	`bestMerchantType` = #{bestMerchantType,jdbcType = VARCHAR},
		 	</if>
		 	<if test="loginNo != null and loginNo !='' ">
		 	`loginNo` = #{loginNo,jdbcType = VARCHAR},
		 	</if>
		 	<if test="bestpayMctNo != null and bestpayMctNo !='' ">
		 	`bestpayMctNo` = #{bestpayMctNo,jdbcType = VARCHAR},
		 	</if>
		 	<if test="resultMsg != null and resultMsg !='' ">
		 	`result_msg` = #{resultMsg,jdbcType = VARCHAR},
		 	</if>
		 	<if test="applymentId != null and applymentId !='' ">
		 	`applyment_id` = #{applymentId,jdbcType = VARCHAR},
		 	</if>
		 	
		 	<if test="bankCode != null and bankCode !='' ">
		 	`bank_code` = #{bankCode,jdbcType = VARCHAR},
		 	</if>
		 	<if test="branchBankName != null and branchBankName !='' ">
		 	`branch_bank_name` = #{branchBankName,jdbcType = VARCHAR},
		 	</if>
		 	<if test="accountNumber != null and accountNumber !='' ">
		 	`account_number` = #{accountNumber,jdbcType = VARCHAR},
		 	</if>
		 	<if test="mobileNo != null and mobileNo !='' ">
		 	`mobile_no` = #{mobileNo,jdbcType = VARCHAR},
		 	</if>
			 `modify_time` = now()
		 WHERE
			`patch_no` = #{patchNo,jdbcType = VARCHAR}
    </update>
    
    <select id="getTdMerchantReport" parameterType="com.qifenqian.bms.merchant.reported.bean.TdMerchantReportInfo"  resultType="com.qifenqian.bms.merchant.reported.bean.TdMerchantReportInfo">
		SELECT
			t.id,
			t.merchant_code,
			t.patch_no,
			t.channel_no,
			t.report_status,
			t.report_time
		FROM
			td_merchant_report t
		<where>
			1=1
			<if test="merchantCode != null and merchantCode != '' ">
			and t.merchant_code = #{merchantCode,jdbcType = VARCHAR} 
			</if>
			<if test="channelNo != null and channelNo != '' ">
			and t.channel_no = #{channelNo,jdbcType = VARCHAR}
			</if>
		</where>
		ORDER BY t.report_time DESC
		LIMIT 1
	</select>
    
    <update id="updateTdMerchantReport"  parameterType="com.qifenqian.bms.merchant.reported.bean.TdMerchantReportInfo" >
    	 UPDATE `stcdb`.`td_merchant_report`
			SET 
			<if test="reportStatus != null and reportStatus !='' ">
		 	`report_status` = #{reportStatus,jdbcType = VARCHAR}
		 	</if>
		 <where>
			<if test="merchantCode != null and merchantCode != '' ">
			`merchant_code` = #{merchantCode,jdbcType = VARCHAR} 
			</if>
			<if test="channelNo != null and channelNo != '' ">
			and channel_no = #{channelNo,jdbcType = VARCHAR}
			</if>
			<if test="patchNo != null and patchNo != '' ">
			and patch_no = #{patchNo,jdbcType = VARCHAR}
			</if>
		</where>
    </update>
    
    <!-- 写入商户报备表 -->
	<insert id="insertTdMerchantReport" parameterType="com.qifenqian.bms.merchant.reported.bean.TdMerchantReportInfo">
		INSERT INTO `stcdb`.`td_merchant_report` (
			`id`,
			`merchant_code`,
			`patch_no`,
			`channel_no`,
			`report_status`,
			`report_time`
		)
		VALUES
			(
				#{id,jdbcType = VARCHAR},
				#{merchantCode,jdbcType = VARCHAR},
				#{patchNo,jdbcType = VARCHAR},
				#{channelNo,jdbcType = VARCHAR},
				#{reportStatus,jdbcType = VARCHAR},
				now()
			)
	</insert>
	
	<!-- 写入商户报备明细表 -->
	<insert id="insertTdMerchantDetailInfoAllinPay" parameterType="com.qifenqian.bms.merchant.reported.bean.AllinPayBean">
		INSERT INTO `stcdb`.`td_merchant_detail_info_allin_pay` (
			`merchant_code`,
			`cust_name`,
			`short_name`,
			`mec_type_flag`,
			`industry`,
			`contact_phone`,
			`merchant_province`,
			`merchant_city`,
			`cpr_reg_addr`,
			`cpr_reg_nm_cn`,
			`business_effective_term`,
			`business_term`,
			`business_license`,
			`expanduser`,
			`offlag`,
			`contract_date`,
			`representative_name`,
			`representative_cert_no`,
			`representative_cert_type`,
			`id_term_start`,
			`id_term_end`,
			`attention_name`,
			`attention_mobile`,
			`account_nm`,
			`account_no`,
			`clear_mode`,
			`accttp`,
			`bank_province`,
			`bank_city`,
			`branch_bank`,
			`inter_bank_code`,
			`inter_bank_name`,
			`bank_code`,
			`per_ent_flag`,
			`certify_no`,
			`business_photo_path`,
			`legal_cert_attribute1_path`,
			`legal_cert_attribute2_path`,
			`door_photo_path`,
			`shop_interior_path`,
			`hand_id_card_path`,
			`business_place_path`,
			`other_material_path`,
			`out_merchant_code`,
			`mch_id`,
			`create_time`,
			`modify_time`
		)
		VALUES
			(
				#{merchantCode,jdbcType = VARCHAR},
				#{custName,jdbcType = VARCHAR},
				#{shortName,jdbcType = VARCHAR},
				#{mecTypeFlag,jdbcType = VARCHAR},
				#{industry,jdbcType = VARCHAR},
				#{contactPhone,jdbcType = VARCHAR},
				#{merchantProvince,jdbcType = VARCHAR},
				#{merchantCity,jdbcType = VARCHAR},
				#{cprRegAddr,jdbcType = VARCHAR},
				#{cprRegNmCn,jdbcType = VARCHAR},
				#{businessEffectiveTerm,jdbcType = VARCHAR},
				#{businessTerm,jdbcType = VARCHAR},
				#{businessLicense,jdbcType = VARCHAR},
				#{expanduser,jdbcType = VARCHAR},
				#{offlag,jdbcType = VARCHAR},
				#{contractDate,jdbcType = VARCHAR},
				#{representativeName,jdbcType = VARCHAR},
				#{representativeCertNo,jdbcType = VARCHAR},
				#{representativeCertType,jdbcType = VARCHAR},
				#{idTermStart,jdbcType = VARCHAR},
				#{idTermEnd,jdbcType = VARCHAR},
				#{attentionName,jdbcType = VARCHAR},
				#{attentionMobile,jdbcType = VARCHAR},
				#{accountNm,jdbcType = VARCHAR},
				#{accountNo,jdbcType = VARCHAR},
				#{clearMode,jdbcType = VARCHAR},
				#{accttp,jdbcType = VARCHAR},
				#{bankProvince,jdbcType = VARCHAR},
				#{bankCity,jdbcType = VARCHAR},
				#{branchBank,jdbcType = VARCHAR},
				#{interBankCode,jdbcType = VARCHAR},
				#{interBankName,jdbcType = VARCHAR},
				#{bankCode,jdbcType = VARCHAR},
				#{perEntFlag,jdbcType = VARCHAR},
				#{certifyNo,jdbcType = VARCHAR},
				#{businessPhotoPath,jdbcType = VARCHAR},
				#{legalCertAttribute1Path,jdbcType = VARCHAR},
				#{legalCertAttribute2Path,jdbcType = VARCHAR},
				#{doorPhotoPath,jdbcType = VARCHAR},
				#{shopInteriorPath,jdbcType = VARCHAR},
				#{handIdCardPath,jdbcType = VARCHAR},
				#{businessPlacePath,jdbcType = VARCHAR},
				#{otherMaterialPath,jdbcType = VARCHAR},
				#{outMerchantCode,jdbcType = VARCHAR},
				#{mchId,jdbcType = VARCHAR},
				now(),
				now()
			)
	</insert>
	
	 <!-- 写入商户报备产品明细表 -->
	<insert id="insertTdMerchantProductInfoAllinPay" parameterType="com.qifenqian.bms.merchant.reported.bean.AllinPayProductInfo">
		INSERT INTO `stcdb`.`td_merchant_product_info_allin_pay` (
			`id`,
			`merchant_code`,
			`product_id`,
			`mtrx_code`,
			`product_name`,
			`fee_rate`,
			`credit_rate`,
			`low_limit`,
			`top_limit`,
			`create_time`,
			`modify_time`
		)
		VALUES
			(
				#{id,jdbcType = VARCHAR},
				#{merchantCode,jdbcType = VARCHAR},
				#{productId,jdbcType = VARCHAR},
				#{mtrxCode,jdbcType = VARCHAR},
				#{productCode,jdbcType = VARCHAR},
				#{feeRate,jdbcType = VARCHAR},
				#{creditRate,jdbcType = VARCHAR},
				#{lowLimit,jdbcType = VARCHAR},
				#{topLimit,jdbcType = VARCHAR},
				now(),
				now()
			)
	</insert>
	
	<update id="updateTdMerchantDetailInfoAllinPay"  parameterType="com.qifenqian.bms.merchant.reported.bean.AllinPayBean" >
    	 UPDATE `stcdb`.`td_merchant_detail_info_allin_pay`
			SET 
			<if test="outMerchantCode != null and outMerchantCode !='' ">
		 	`out_merchant_code` = #{outMerchantCode,jdbcType = VARCHAR}
		 	</if>
		 <where>
			<if test="merchantCode != null and merchantCode != '' ">
			`merchant_code` = #{merchantCode,jdbcType = VARCHAR} 
			</if>
		</where>
    </update>
</mapper>